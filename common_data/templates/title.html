<section id='title'>
    <div id='title-text'>{% block heading %}
{% endblock heading %}</div>
    <div id='action-icon dropdown'>
        
        <button class="btn btn-block primary dropdown-toggle" id="triggerId" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">A</button>
        
        <div class="dropdown-menu" aria-labelledby="triggerId">
            <a class="dropdown-item" href="#">Action</a>
            {% block actions %}
            {% endblock actions %}
        
        </div>
    </div>
    
    
    <div id='notifications-icon'>
        <button id='notifications-button' class="btn btn-block primary"><i class="text-white fas fa-bell    "></i>
            {% if messages %}
                <span class="badge badge-danger">!</span>
            {% endif %}
        </button>
    </div>
</section>

<div class="notifications">
    <div class="notification-window">
        <div><h4> <button id='close-notifications' class="btn primary"><i class="fas fa-arrow-right"></i></button> Notifications</h4></div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info">
                    {{message}}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
            {% endfor %}
        
        {% endif %}
    </div>
</div>

<script>

function updateNotifications(){
        $.ajax({
            'method': 'GET',
            'url': '/messaging/api/notifications'
        }).then(function (data){
            if(data.unread > 0){
                $('#notification-title').text(data.latest.title);
                $('#notification-timestamp').text(data.latest.stamp);
                $('#notification-message').text(data.latest.message);
                $('#notification-dismiss').attr({
                    'onclick': "$.get('/messaging/api/notifications/mark-read/" + data.latest.id + "')"
                });
                $('#notification-action').attr({
                    'href': data.latest.action,
                    'onclick': "$.get('/messaging/api/notifications/mark-read/" + data.latest.id + "')"
                });
                 $('.notification-overlay').show(500);

            }
        })
    }

$(document).ready(function(){
    //button handlers
    
    document.getElementById('notifications-button').addEventListener('click',
    function(){
    $('.notifications').show()
    $('.notification-window').addClass('visible-notification-window')

    })
     document.getElementById('close-notifications').addEventListener('click',
    function(){
    $('.notifications').hide()

    })
    

    //notification polling
    updateNotifications();
    setInterval(updateNotifications, 60000)

})

</script>